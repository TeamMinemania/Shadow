package net.shadow.feature.module.exploit;

import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.PlayerInteractItemC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.util.Hand;
import net.minecraft.util.math.Vec3d;
import net.shadow.Shadow;
import net.shadow.event.events.PacketOutput;
import net.shadow.feature.base.Module;
import net.shadow.feature.base.ModuleType;
import net.shadow.feature.configuration.SliderValue;
import net.shadow.utils.Utils;

public class Fling extends Module implements PacketOutput {
    final SliderValue delay = this.config.create("Delay", 1, 1, 500, 0);
    final SliderValue updist = this.config.create("Power", 1, 1, 3, 0);

    public Fling() {
        super("Fling", "launch entities with fishing rod", ModuleType.EXPLOIT);
    }

    @Override
    public void onEnable() {
        Shadow.getEventSystem().add(PacketOutput.class, this);
    }

    @Override
    public void onDisable() {
        Shadow.getEventSystem().remove(PacketOutput.class, this);
    }

    @Override
    public void onUpdate() {

    }

    @Override
    public void onRender() {

    }

    @Override
    public void onSentPacket(PacketOutputEvent event) {
        if (event.getPacket() instanceof PlayerInteractItemC2SPacket) {
            if (Shadow.c.player.getInventory().getMainHandStack().getItem() == Items.FISHING_ROD && (Shadow.c.player.fishHook != null || !Shadow.c.player.fishHook.isRemoved())) {
                Shadow.c.player.setVelocity(Vec3d.ZERO);
                event.cancel();
                new Thread(() -> {
                    double staticy = Shadow.c.player.getY();
                    for (int i = 0; i < updist.getThis(); i++) {
                        staticy = staticy + 9;
                        Utils.sleep(5);
                        Shadow.c.player.setVelocity(Vec3d.ZERO);
                        Shadow.c.player.networkHandler.sendPacket(new PlayerMoveC2SPacket.PositionAndOnGround(Shadow.c.player.getX(), staticy, Shadow.c.player.getZ(), true));
                    }
                    Utils.sleep(delay.getThis().longValue());
                    Shadow.c.player.networkHandler.getConnection().send(new PlayerInteractItemC2SPacket(Hand.MAIN_HAND));
                    Utils.sleep(delay.getThis().longValue());
                    for (int i = 0; i < updist.getThis(); i++) {
                        staticy = staticy - 9;
                        Utils.sleep(5);
                        Shadow.c.player.setVelocity(Vec3d.ZERO);
                        Shadow.c.player.networkHandler.sendPacket(new PlayerMoveC2SPacket.PositionAndOnGround(Shadow.c.player.getX(), staticy, Shadow.c.player.getZ(), true));
                    }
                }).start();
            }
        }
    }
}
